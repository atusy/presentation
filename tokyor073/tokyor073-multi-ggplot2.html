<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="atusy" />
  <meta name="dcterms.date" content="2018-10-20" />
  <title>tokyor073-multi-ggplot2.utf8</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="tokyor073-multi-ggplot2_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="tokyor073-multi-ggplot2_files/reveal.js-3.3.0.1/css/theme/night.css" id="theme">

<style type="text/css">
.reveal section img {
  background: rgba(255, 255, 255, 0.85);
}
</style>

  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="style.css"/>

<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title"><div class="line-block">ggplot2で図を並べる<br />
<span style="font-size: 50%">〜facetごり押した私とpatchworkとの出会い〜</span></div></h1>
    <h2 class="author">atusy</h2>
    <h3 class="date">2018-10-20</h3>
</section>

<section><section class="title-slide slide level1"><h1>自己紹介</h1></section><section id="atusy" class="slide level2">
<h2>Atusy</h2>
<ul>
<li>R一筋5年
<ul>
<li>データ可視化の効率化がきっかけ</li>
<li>ggplot2を含めTidyverse歴約3年</li>
</ul></li>
<li>JuliaとかPythonとかやるやる詐欺してます</li>
<li>Tokyo R は #72 以来2回目</li>
<li>(株) 蒜山地質年代学研究所
<ul>
<li>地質試料の化学分析</li>
<li>データ解析用Rパッケージ開発</li>
</ul></li>
</ul>
<p>Blog: <a href="https://atusy.github.io/blog/" class="uri">https://atusy.github.io/blog/</a></p>
</section><section id="editors-choice" class="slide level2">
<h2>投稿論文がEditor’s choiceになった</h2>
<p>ggplot2が沢山並んでるのでチラ見してみてネ (オープンアクセス)</p>
<div style="font-size:75%">
<p><a href="https://www.degruyter.com/view/j/ammin.2018.103.issue-10/am-2018-6323CCBY/am-2018-6323CCBY.xml">A rapid and precise quantitative electron probe chemical mapping technique and its application to an ultrahigh-pressure eclogite from the Moldanubian Zone of the Bohemian Massif (Nové Dvory, Czech Republic)</a></p>
</div>
<div style="font-size:50%">
<blockquote>
<p>Yasumoto et al. develop a new chemical mapping technique that relates mineral-scale compositions (obtained from EMPA) to whole rock compositions. Their model, called QntMap, is applied to a mineralogically layered UHP eclogite (Nové Dvory) from the Czech Republic, previously interpreted as a high-pressure cumulate. Their map of a 3 cm<sup>2</sup> area, however, shows that in moving from the garnet- to the pyroxene-rich layer, Cr and Mg# increase in both garnet and pyroxene phases. They conclude that this disequilibrium feature results from a melt (the pyroxenite layer) that was injected into a garnet-rich UHP host. The potential reach goes much further. This research could serve as an excellent tool to evaluate hypotheses of granite emplacement or so-considered fluid-driven alteration within a myriad of settings.</p>
</blockquote>
<p><a href="http://www.minsocam.org/MSA/Ammin/AM_Notable_Articles.html" class="uri">http://www.minsocam.org/MSA/Ammin/AM_Notable_Articles.html</a></p>
</div>
<p>私のggplot2力はこの論文に鍛えられた</p>
<aside class="notes">
最近嬉しかったことは，今月公開の投稿論文がEditor’s choiceになったことです．
</aside>
</section></section>
<section><section class="title-slide slide level1"><h1>色々な図の並べ方</h1></section><section class="slide level2">
<h2>ある変数について集団ごとのヒストグラム</h2>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-1-1.svg" width="768" /></p>
</section><section id="yx" class="slide level2">
<h2>y軸を固定してx軸を変えた散布図</h2>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-2-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>ヒストグラムと散布図</h2>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-3-1.svg" width="768" /></p>
</section><section id="graphicsplot" class="slide level2">
<h2>graphics::plotでもできなくはない</h2>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-4-1.png" width="768" /></p>
</section></section>
<section><section id="-mtcars-and-their-friends" class="title-slide slide level1"><h1>今日使うデータセット <br> <strong>mtcars</strong> and their friends</h1></section><section id="motor-trend-car-road-tests" class="slide level2">
<h2>Motor Trend Car Road Tests</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">str</span>(mtcars)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
<p>(Henderson and Velleman, 1981)</p>
</section><section id="mtcars-" class="slide level2">
<h2><code>?mtcars</code> によると</h2>
<ul>
<li><strong>mpg</strong>: mile / gallon</li>
<li>cyl: シリンダー数</li>
<li>disp: 排気量</li>
<li><strong>hp</strong>: 馬力</li>
<li>drat: 後輪車軸比</li>
<li><strong>wt</strong>: 重量(1000 lbs)</li>
<li>qsec: 走行時間(1/4mile)</li>
<li><strong>vs</strong>: 0 = V型, 1 = 直列</li>
<li><strong>am</strong>: 0 = オートマ, 1 = マニュアル</li>
<li>gear: ギア数</li>
<li>carb: キャブレター数</li>
</ul>
</section><section id="-mtcars-minicars" class="slide level2">
<h2>データ整形 (mtcars → minicars)</h2>
<ul>
<li>列選択 (mpg, hp, wt, vs, am)</li>
<li>2値データを文字列に変換 (vs, am)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># A modern approach</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb3-3" title="3">minicars &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">  </span><span class="kw">select</span>(mpg, wt, hp, vs, am) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">vs =</span> <span class="kw">c</span>(<span class="st">&#39;V-shaped&#39;</span>, <span class="st">&#39;Straight&#39;</span>)[vs <span class="op">+</span><span class="st"> </span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">am =</span> <span class="kw">c</span>(<span class="st">&#39;Automatic&#39;</span>, <span class="st">&#39;Manual&#39;</span>)[am <span class="op">+</span><span class="st"> </span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb3-8" title="8">  )</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># A classic approach</span></a>
<a class="sourceLine" id="cb4-2" title="2">minicars &lt;-<span class="st"> </span>mtcars[<span class="kw">c</span>(<span class="st">&#39;mpg&#39;</span>, <span class="st">&#39;wt&#39;</span>, <span class="st">&#39;hp&#39;</span>)]</a>
<a class="sourceLine" id="cb4-3" title="3">minicars<span class="op">$</span>vs &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mtcars<span class="op">$</span>vs <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;Straight&#39;</span>, <span class="st">&#39;V-shaped&#39;</span>)</a>
<a class="sourceLine" id="cb4-4" title="4">minicars<span class="op">$</span>am &lt;-<span class="st"> </span><span class="kw">ifelse</span>(mtcars<span class="op">$</span>am <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;Manual&#39;</span>, <span class="st">&#39;Automatic&#39;</span>)</a></code></pre></div>
</section><section id="-minicars-longcars" class="slide level2">
<h2>データ整形 (minicars → longcars)</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb5-2" title="2">longcars &lt;-<span class="st"> </span><span class="kw">gather</span>(minicars, var, val, <span class="op">-</span>am, <span class="op">-</span>vs, <span class="op">-</span>mpg)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co"># wt列とhp列がの列名がvar列の値に、それぞれの値がval列に入る</span></a></code></pre></div>
<div class = 'left', style = 'color:#CCCCCC;font-size:80%' />
<p>minicars</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">hp</th>
<th style="text-align: left;">vs</th>
<th style="text-align: left;">am</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">110</td>
<td style="text-align: left;">V-shaped</td>
<td style="text-align: left;">Manual</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">110</td>
<td style="text-align: left;">V-shaped</td>
<td style="text-align: left;">Manual</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">93</td>
<td style="text-align: left;">Straight</td>
<td style="text-align: left;">Manual</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">110</td>
<td style="text-align: left;">Straight</td>
<td style="text-align: left;">Automatic</td>
</tr>
</tbody>
</table>
</div>
<div class = 'right', style = 'font-size:80%' />
<p>longcars</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">mpg</th>
<th style="text-align: left;">vs</th>
<th style="text-align: left;">am</th>
<th style="text-align: left;">var</th>
<th style="text-align: right;">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">21.0</td>
<td style="text-align: left;">V-shaped</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">wt</td>
<td style="text-align: right;">2.620</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.0</td>
<td style="text-align: left;">V-shaped</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">wt</td>
<td style="text-align: right;">2.875</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: left;">Straight</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">wt</td>
<td style="text-align: right;">2.320</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: left;">Straight</td>
<td style="text-align: left;">Automatic</td>
<td style="text-align: left;">wt</td>
<td style="text-align: right;">3.215</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21.0</td>
<td style="text-align: left;">V-shaped</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">hp</td>
<td style="text-align: right;">110.000</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.0</td>
<td style="text-align: left;">V-shaped</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">hp</td>
<td style="text-align: right;">110.000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22.8</td>
<td style="text-align: left;">Straight</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">hp</td>
<td style="text-align: right;">93.000</td>
</tr>
<tr class="even">
<td style="text-align: right;">21.4</td>
<td style="text-align: left;">Straight</td>
<td style="text-align: left;">Automatic</td>
<td style="text-align: left;">hp</td>
<td style="text-align: right;">110.000</td>
</tr>
</tbody>
</table>
</div>
</section><section id="tidyrgather-spread" class="slide level2">
<h2>tidyr::gather (とspread)</h2>
<p>各列の名前をkey列の値に、値をval列にまとめる。<br />
<code>-列名</code> で、<code>gather</code>しない変数を指定できる。<br />
<code>spread</code> で戻せる。</p>
<div class="left">
<p>wide format<br />
<code>spread(long, key, value)</code></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">a</th>
<th style="text-align: right;">x1</th>
<th style="text-align: right;">x2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">b</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="right">
<p>long format<br />
<code>gather(wide, key, value, -a)</code></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">a</th>
<th style="text-align: left;">key</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: left;">x1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">b</td>
<td style="text-align: left;">x1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: left;">x2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">b</td>
<td style="text-align: left;">x2</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</section><section id="longcars" class="slide level2">
<h2>longcarsはこんな感じ</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">library</span>(summarytools)</a>
<a class="sourceLine" id="cb6-2" title="2">longcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">dfSummary</span>(</a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="dt">graph.col =</span> <span class="ot">FALSE</span>, <span class="dt">varnumbers =</span> <span class="ot">FALSE</span>, <span class="dt">valid.col =</span> <span class="ot">FALSE</span>, <span class="dt">omit.heading =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb6-5" title="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="st">  </span><span class="kw">view</span>(<span class="dt">method =</span> <span class="st">&#39;render&#39;</span>, <span class="dt">report.title =</span> <span class="ot">NA</span>, <span class="dt">footnote =</span> <span class="ot">NA</span>)</a></code></pre></div>
<div class="container st-container"><table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
  <thead>
    <tr>
      <th align="center"><strong>Variable</strong></th>
      <th align="center"><strong>Stats / Values</strong></th>
      <th align="center"><strong>Freqs (% of Valid)</strong></th>
      <th align="center"><strong>Missing</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="left">mpg
[numeric]</td>
      <td align="left">mean (sd) : 20.09 (5.98)
min &lt; med &lt; max :
10.4 &lt; 19.2 &lt; 33.9
IQR (CV) : 7.38 (0.3)</td>
      <td align="left">25 distinct values</td>
      <td align="center">0
(0%)</td>
    </tr>
    <tr>
      <td align="left">vs
[character]</td>
      <td align="left">1. Straight
2. V-shaped</td>
      <td align="left">28 (43.8%)
36 (56.2%)</td>
      <td align="center">0
(0%)</td>
    </tr>
    <tr>
      <td align="left">am
[character]</td>
      <td align="left">1. Automatic
2. Manual</td>
      <td align="left">38 (59.4%)
26 (40.6%)</td>
      <td align="center">0
(0%)</td>
    </tr>
    <tr>
      <td align="left">var
[character]</td>
      <td align="left">1. hp
2. wt</td>
      <td align="left">32 (50.0%)
32 (50.0%)</td>
      <td align="center">0
(0%)</td>
    </tr>
    <tr>
      <td align="left">val
[numeric]</td>
      <td align="left">mean (sd) : 74.95 (86.84)
min &lt; med &lt; max :
1.51 &lt; 28.71 &lt; 335
IQR (CV) : 119.62 (1.16)</td>
      <td align="left">51 distinct values</td>
      <td align="center">0
(0%)</td>
    </tr>
  </tbody>
</table></div>
</section></section>
<section><section id="ggplot2" class="title-slide slide level1"><h1>ggplot2基礎</h1></section><section class="slide level2">
<h2>ヒストグラム</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">data =</span> minicars, <span class="co"># プロットしたいデータフレーム</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">mapping =</span> <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="dt">x =</span> mpg, <span class="co"># ヒストグラムにしたい変数</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">fill =</span> vs <span class="co"># 棒の塗り分けに使いたい変数 (オプション)</span></a>
<a class="sourceLine" id="cb7-7" title="7">  ) </a>
<a class="sourceLine" id="cb7-8" title="8">) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="co"># ヒストグラムを描写</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-14-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>散布図</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg, <span class="dt">color =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="co"># 散布図を描写</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co"># `data` と `mapping`の引数名は省略することが多い</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-15-1.svg" width="768" /></p>
</section><section id="-theme_classic" class="slide level2">
<h2>テーマ変更: <code>theme_classic()</code></h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="co"># 直前のプロット</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="co"># テーマの変更</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-16-1.svg" width="768" /></p>
</section><section id="-theme_gray" class="slide level2">
<h2>テーマ変更: <code>theme_gray()</code></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="co"># 直前のプロット</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span><span class="kw">theme_gray</span>() <span class="co"># テーマの変更</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-17-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>テーマを更に弄る</h2>
<p><code>?theme</code> 参照……。</p>
</section></section>
<section><section id="facet-grid-intro" class="title-slide slide level1"><h1><code>facet_grid</code> <br> 注目する変数でグラフを表形式に分割</h1></section><section id="-" class="slide level2">
<h2>行で分割する変数 ~ 列で分割する変数</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>am) <span class="co"># or facet_grid(rows = vars(vs), cols = vars(am))</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-18-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>データ整形は大事</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>am)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-19-1.svg" width="768" /></p>
<p>V型エンジンのMT車はどれ？</p>
</section><section id="--" class="slide level2">
<h2>審美的属性 (色や形) での表現も忘れずに</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg, <span class="dt">colour =</span> vs, <span class="dt">shape =</span> am)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-20-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>行で分割</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>.) <span class="co"># or facet_grid(rows = vars(vs))</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-21-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>列で分割</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>vs <span class="op">+</span><span class="st"> </span>am) <span class="co"># or facet_grid(cols = vars(vs, am))</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-22-1.svg" width="768" /></p>
<p>行内・列内で複数の変数を使った分割も可能</p>
</section></section>
<section><section id="facet-grid-1d" class="title-slide slide level1"><h1>1次元データのグラフで<code>facet_grid</code></h1></section><section class="slide level2">
<h2>ヒストグラムを系列ごとに分割</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(<span class="dt">x =</span> mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>.)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-23-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>ヒストグラムを変数ごと系列ごとに分割</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">ggplot</span>(longcars, <span class="kw">aes</span>(<span class="dt">x =</span> val)) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>var) </a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-24-1.svg" width="768" /></p>
</section><section id="scales-free_x-x" class="slide level2">
<h2><code>scales = 'free_x'</code> でx軸の範囲を可変に</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>var, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>) </a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co"># scalesは&#39;fixed&#39; (規定値), &#39;free_x&#39;, &#39;free_y&#39;, &#39;free&#39;のいずれか</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-25-1.svg" width="768" /></p>
<p>直列型はV型より低馬力で軽量</p>
</section><section id="stripswitch-both" class="slide level2">
<h2>stripの位置を<code>switch = 'both'</code></h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>var, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>, <span class="dt">switch =</span> <span class="st">&#39;both&#39;</span>) </a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co"># switchはNULL (既定値), &#39;x&#39;, &#39;y&#39;, &#39;both&#39;のいずれか</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-26-1.svg" width="768" /></p>
</section><section id="strip.placement" class="slide level2">
<h2>stripを目盛の外側へ</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.placement =</span> <span class="st">&#39;outside&#39;</span>)</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="co"># strip.placementは&#39;inside&#39; (既定値) か &#39;outside&#39;</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-27-1.svg" width="768" /></p>
</section><section id="strip.background" class="slide level2">
<h2>stripの背景をなくす</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-28-1.svg" width="768" /></p>
</section><section id="strip.text.x" class="slide level2">
<h2>x軸stripのフォントサイズを変更</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>))</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-29-1.svg" width="768" /></p>
</section><section id="axis.title.x" class="slide level2">
<h2>x軸のタイトルを消す</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-30-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>一気に</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">ggplot</span>(longcars, <span class="kw">aes</span>(<span class="dt">x =</span> val)) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>var, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>, <span class="dt">switch =</span> <span class="st">&#39;both&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb24-5" title="5">    <span class="dt">strip.placement =</span> <span class="st">&#39;outside&#39;</span>,</a>
<a class="sourceLine" id="cb24-6" title="6">    <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb24-7" title="7">    <span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb24-8" title="8">    <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb24-9" title="9">  )</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-31-1.svg" width="768" /></p>
</section></section>
<section><section id="facet-grid-2d" class="title-slide slide level1"><h1>2次元データのグラフでfacet_grid</h1></section><section id="vary-x-fix-y" class="slide level2">
<h2>y軸を固定してx軸を変える</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">ggplot</span>(longcars, <span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">y =</span> mpg, <span class="dt">colour =</span> am, <span class="dt">shape =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>var, <span class="dt">scales =</span> <span class="st">&#39;free&#39;</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-32-1.svg" width="768" /></p>
</section><section id="nice-facet-grid" class="slide level2">
<h2>見やすく</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb26-2" title="2"><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>var, <span class="dt">scales =</span> <span class="st">&#39;free&#39;</span>, <span class="dt">switch =</span> <span class="st">&#39;x&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb26-4" title="4"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb26-5" title="5">    <span class="dt">strip.placement =</span> <span class="st">&#39;outside&#39;</span>,</a>
<a class="sourceLine" id="cb26-6" title="6">    <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb26-7" title="7">    <span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb26-8" title="8">    <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb26-9" title="9">  )</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-33-1.svg" width="768" /></p>
<p><a href="#/scales-facet-wrap">図ごとにy軸を表示したい場合はfacet_wrapを使おう</a></p>
</section><section id="-ggallyggpairs-good" class="slide level2">
<h2>初手に <code>GGally::ggpairs</code> もGOOD</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">GGally<span class="op">::</span><span class="kw">ggpairs</span>(minicars, <span class="kw">aes</span>(<span class="dt">color =</span> am, <span class="dt">shape =</span> vs))</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-34-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>変数が多いと見辛い</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">GGally<span class="op">::</span><span class="kw">ggpairs</span>(mtcars)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-35-1.svg" width="768" /></p>
</section></section>
<section><section id="facet_wrap-" class="title-slide slide level1"><h1>facet_wrap <br> 分割したグラフを改行しつつ並べる</h1></section><section class="slide level2">
<h2>~ 分割する変数</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb29-2" title="2">  <span class="kw">gather</span>(<span class="kw">select_if</span>(mtcars, is.numeric)),</a>
<a class="sourceLine" id="cb29-3" title="3">  <span class="kw">aes</span>(value)</a>
<a class="sourceLine" id="cb29-4" title="4">) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>) </a>
<a class="sourceLine" id="cb29-7" title="7">  <span class="co"># facet_wrap(facets = vars(key), scales = &#39;free_x&#39;)</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-36-1.svg" width="768" /></p>
</section><section id="-dir-v" class="slide level2">
<h2>列ごとに並べる (<code>dir = 'v'</code>)</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>, <span class="dt">dir =</span> <span class="st">&#39;v&#39;</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-37-1.svg" width="768" /></p>
</section><section id="nrow-" class="slide level2">
<h2><code>nrow</code> 引数で行数を制御</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-38-1.svg" width="768" /></p>
</section><section id="ncol-" class="slide level2">
<h2><code>ncol</code> 引数で列数を制御</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-39-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>変数が多い時に便利</h2>
<p>変数が多いとfacet_gridは辛い</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">last_plot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&#39;free_x&#39;</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-40-1.svg" width="768" /></p>
</section><section id="scales-facet-wrap" class="slide level2">
<h2>scalesがfreeな軸の目盛は各図に描写</h2>
<p><a href="#/nice-facet-grid">facet_gridは端の図にのみ軸を描写する</a></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">ggplot</span>(longcars, <span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">y =</span> mpg, <span class="dt">colour =</span> am, <span class="dt">shape =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-3" title="3"><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>var, <span class="dt">scales =</span> <span class="st">&#39;free&#39;</span>, <span class="dt">strip.position =</span> <span class="st">&#39;bottom&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb34-5" title="5"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb34-6" title="6">    <span class="dt">strip.placement =</span> <span class="st">&#39;outside&#39;</span>,</a>
<a class="sourceLine" id="cb34-7" title="7">    <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb34-8" title="8">    <span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb34-9" title="9">    <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb34-10" title="10">  )</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-41-1.svg" width="768" /></p>
</section></section>
<section><section id="facet" class="title-slide slide level1"><h1>facet逆引き</h1></section><section id="as-table" class="slide level2">
<h2>並び順を反転したい (<code>as.table = FALSE</code>)</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># 既定値はTRUE</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;as.table = TRUE&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-3" title="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>vs, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">as.table =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb35-4" title="4"></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="co"># FALSEにしてみる</span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;as.table = FALSE&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>vs, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">as.table =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-42-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>並び順を制御したい</h2>
<p>facetする変数をfactor型にすると、levels順になる。<br />
factorの操作には<code>forcats</code> パッケージが便利 (参考: <a href="https://kazutan.github.io/kazutanR/forcats_test.html">ぞうさんの記事</a>)</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb36-2" title="2">minicars2 &lt;-<span class="st"> </span>minicars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vs =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(vs, <span class="st">&#39;V-shaped&#39;</span>))</a>
<a class="sourceLine" id="cb36-4" title="4"><span class="kw">ggplot</span>(minicars2, <span class="kw">aes</span>(mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb36-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb36-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>vs, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-43-1.svg" width="768" /></p>
<p>Tip: 凡例などの順序もfactorで制御できる</p>
</section><section id="stripa-b-" class="slide level2">
<h2>stripで図a, b, …したい</h2>
<p>facetする変数を予め整形しておく</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">minicars2 &lt;-<span class="st"> </span>minicars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vs =</span> <span class="kw">paste0</span>(<span class="st">&#39;(&#39;</span>, letters[<span class="kw">factor</span>(vs)], <span class="st">&#39;) &#39;</span>, vs))</a>
<a class="sourceLine" id="cb37-3" title="3"><span class="kw">ggplot</span>(minicars2, <span class="kw">aes</span>(mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb37-5" title="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>vs, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-44-1.svg" width="768" /></p>
</section><section id="margins1" class="slide level2">
<h2>未分割の図も並べる (<code>margins = TRUE</code>)</h2>
<p><code>facet_grid</code> 専用</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(mpg, <span class="dt">fill =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb38-3" title="3"><span class="st">  </span><span class="kw">facet_grid</span>(vs <span class="op">~</span><span class="st"> </span>., <span class="dt">margins =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-45-1.svg" width="768" /></p>
</section><section id="margin2" class="slide level2">
<h2>未分割の図も並べる (<code>margins = TRUE</code>)</h2>
<p>審美的属性にも使う変数でfacetする場合は、<br />
その変数のコピーでfacetする</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">minicars2 &lt;-<span class="st"> </span>minicars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> vs)</a>
<a class="sourceLine" id="cb39-3" title="3"><span class="kw">ggplot</span>(minicars2, <span class="kw">aes</span>(mpg, <span class="dt">fill =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb39-5" title="5"><span class="st">  </span><span class="kw">facet_grid</span>(facet <span class="op">~</span><span class="st"> </span>., <span class="dt">margins =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-46-1.svg" width="768" /></p>
</section><section id="-data-wrangling" class="slide level2">
<h2>未分割の図も並べる (data wrangling)</h2>
<p><code>facet_grid</code> でも <code>facet_wrap</code> でも使える</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">minicars2 &lt;-<span class="st"> </span>minicars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> vs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-3" title="3"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">mutate</span>(., <span class="dt">facet =</span> <span class="st">&#39;All&#39;</span>))</a>
<a class="sourceLine" id="cb40-4" title="4"><span class="kw">ggplot</span>(minicars2, <span class="kw">aes</span>(mpg, <span class="dt">fill =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb40-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb40-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>facet, <span class="dt">strip.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-47-1.svg" width="768" /></p>
</section><section id="vary-plot-types" class="slide level2">
<h2>異種の図を並べたい</h2>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">minicars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="st">  </span><span class="kw">transmute</span>(mpg, <span class="dt">hist =</span> <span class="dv">1</span>, <span class="dt">dens =</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-3" title="3"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">mutate</span>(., <span class="dt">hist =</span> <span class="ot">NA_integer_</span>, <span class="dt">dens =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(hist), <span class="st">&#39;count&#39;</span>, <span class="st">&#39;density&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-6" title="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mpg <span class="op">*</span><span class="st"> </span>hist)) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-7" title="7"><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mpg <span class="op">*</span><span class="st"> </span>dens)) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-8" title="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>facet, <span class="dt">scales =</span> <span class="st">&#39;free_y&#39;</span>, <span class="dt">strip.position =</span> <span class="st">&#39;left&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-9" title="9"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb41-10" title="10">    <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb41-11" title="11">    <span class="dt">strip.placement =</span> <span class="st">&#39;outside&#39;</span>,</a>
<a class="sourceLine" id="cb41-12" title="12">    <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb41-13" title="13">    <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>)</a>
<a class="sourceLine" id="cb41-14" title="14">  )</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-48-1.svg" width="768" /></p>
</section><section id="grid-vs-wrap" class="slide level2">
<h2><code>facet_grid</code> と <code>facet_wrap</code> の引数</h2>
<table style="width:93%;">
<colgroup>
<col style="width: 44%" />
<col style="width: 27%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">目的</th>
<th style="text-align: left;">facet_grid</th>
<th style="text-align: left;">facet_wrap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">facetする変数を指定</td>
<td style="text-align: left;">rows, cols, <del>facets</del></td>
<td style="text-align: left;">facets</td>
</tr>
<tr class="even">
<td style="text-align: left;">行数・列数を変える</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">nrow, ncol</td>
</tr>
<tr class="odd">
<td style="text-align: left;">軸の範囲を可変にする</td>
<td style="text-align: left;">scales, <strong>shrink</strong></td>
<td style="text-align: left;">scales, <strong>shrink</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">図の表示サイズを可変にする</td>
<td style="text-align: left;"><strong>space</strong></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">stripの位置を変更</td>
<td style="text-align: left;">switch</td>
<td style="text-align: left;">strip.position <del>switch</del></td>
</tr>
<tr class="even">
<td style="text-align: left;">stripの文字列を変更</td>
<td style="text-align: left;"><strong>labeller</strong></td>
<td style="text-align: left;"><strong>labeller</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">stripの並べ方を変更</td>
<td style="text-align: left;">as.table</td>
<td style="text-align: left;">as.table, dir</td>
</tr>
<tr class="even">
<td style="text-align: left;">factorでfacetした時データに 含まれない水準を表示する</td>
<td style="text-align: left;"><strong>drop</strong></td>
<td style="text-align: left;"><strong>drop</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">分割前の図も並べる</td>
<td style="text-align: left;">margins</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p><strong>赤字</strong> は未紹介・ <del>打ち消し</del> は Deprecated</p>
</section></section>
<section><section id="patchwork-" class="title-slide slide level1"><h1><code>patchwork</code> で自由に図を並べる</h1></section><section id="patchwork" class="slide level2">
<h2></h2>
<p><img data-src="https://github.com/thomasp85/patchwork/blob/master/man/figures/logo.png?raw=true" /></p>
<p><a href="https://github.com/thomasp85/patchwork" class="uri">https://github.com/thomasp85/patchwork</a></p>
<p>二項演算子を利用して、<br />
ggplot2で作った図を簡単に <strong>継ぎ接ぎ</strong> できるパッケージ</p>
<p>参考記事 by かつどんさん (<span class="citation" data-cites="nozma">@nozma</span>)<br />
<a href="https://qiita.com/nozma/items/4512623bea296ccb74ba">patchworkのREADME邦訳+α</a><br />
<a href="https://qiita.com/nozma/items/cd98ec7938e0783d5d89">patchwork以外の選択肢</a></p>
</section><section class="slide level2">
<h2>インストール</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="co"># devtoolsをインストールしていない人はまず</span></a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">install.packages</span>(<span class="st">&#39;devtools&#39;</span>)</a>
<a class="sourceLine" id="cb42-3" title="3"></a>
<a class="sourceLine" id="cb42-4" title="4"><span class="co"># GitHubからpatchworkをインストール</span></a>
<a class="sourceLine" id="cb42-5" title="5">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&#39;thomasp85/patchwork&#39;</span>)</a>
<a class="sourceLine" id="cb42-6" title="6"></a>
<a class="sourceLine" id="cb42-7" title="7"><span class="co"># 読み込み</span></a>
<a class="sourceLine" id="cb42-8" title="8"><span class="kw">library</span>(patchwork)</a></code></pre></div>
</section><section id="side-by-side" class="slide level2">
<h2><code>|</code>で図を横に並べる</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(minicars) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(wt, mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;p1&#39;</span>)</a>
<a class="sourceLine" id="cb43-2" title="2">p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(minicars) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(hp, mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;p2&#39;</span>)</a>
<a class="sourceLine" id="cb43-3" title="3">p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(minicars) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(wt)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;p3&#39;</span>)</a>
<a class="sourceLine" id="cb43-4" title="4">p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(minicars) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(mpg)) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;p4&#39;</span>)</a>
<a class="sourceLine" id="cb43-5" title="5">p1 <span class="op">|</span><span class="st"> </span>p2 <span class="op">|</span><span class="st"> </span>p3 <span class="op">|</span><span class="st"> </span>p4</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-51-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2><code>/</code>で図を縦に並べる</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">p3 <span class="op">/</span><span class="st"> </span>p1</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-52-1.svg" width="768" /></p>
</section><section id="group-by-brackets" class="slide level2">
<h2><code>()</code>でネストする</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">p3 <span class="op">/</span><span class="st"> </span>(p1 <span class="op">|</span><span class="st"> </span>p4) <span class="op">|</span><span class="st"> </span>p2</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-53-1.svg" width="768" /></p>
</section><section id="plot-spacer" class="slide level2">
<h2>空白のプロットは<code>plot_spacer()</code></h2>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">(p3 <span class="op">|</span><span class="st"> </span><span class="kw">plot_spacer</span>()) <span class="op">/</span><span class="st"> </span>(p1 <span class="op">|</span><span class="st"> </span>p4)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-54-1.svg" width="768" /></p>
<p>もうちょっと良いスペーサーが欲しい (xx)</p>
<p>周辺分布なら <code>ggExtra::ggMarginal</code></p>
</section><section class="slide level2">
<h2>全体のテーマを変える</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">(p1 <span class="op">/</span><span class="st"> </span>(p3 <span class="op">|</span><span class="st"> </span>p4) <span class="op">/</span><span class="st"> </span>p2) <span class="op">&amp;</span><span class="st"> </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-55-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>最外ネストのテーマを変える</h2>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">(p1 <span class="op">/</span><span class="st"> </span>(p3 <span class="op">|</span><span class="st"> </span>p4) <span class="op">/</span><span class="st"> </span>p2) <span class="op">*</span><span class="st"> </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-56-1.svg" width="768" /></p>
</section><section id="wrap-plots1" class="slide level2">
<h2>レイアウトお任せなら<code>wrap_plots()</code></h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">wrap_plots</span>(p1, p2, p3, p4)</a>
<a class="sourceLine" id="cb49-2" title="2"><span class="co"># wrap_plots(list(p1, p2, p3, p4))</span></a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-57-1.svg" width="768" /></p>
</section><section id="wrap-plots2" class="slide level2">
<h2>レイアウトお好みでも<code>wrap_plots()</code></h2>
<p>行数や列数、行の高さの比、列の幅の比なども弄れる</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">wrap_plots</span>(p3, p2, p1, p4, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">heights =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-58-1.svg" width="768" /></p>
</section><section id="combo" class="slide level2">
<h2><code>|</code>, <code>/</code>, <code>wrap_plots</code> は組み合わせ可能</h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="kw">wrap_plots</span>(p1, p1 <span class="op">|</span><span class="st"> </span>p2, p3 <span class="op">/</span><span class="st"> </span>p4, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-59-1.svg" width="768" /></p>
</section><section id="plot-annotation" class="slide level2">
<h2>注釈をつけるには<code>plot_annotation()</code></h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">(p1 <span class="op">|</span><span class="st"> </span>p2) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-2" title="2"><span class="st">  </span><span class="kw">plot_annotation</span>(</a>
<a class="sourceLine" id="cb52-3" title="3">    <span class="dt">title =</span> <span class="st">&#39;title&#39;</span>,</a>
<a class="sourceLine" id="cb52-4" title="4">    <span class="dt">subtitle =</span> <span class="st">&#39;subtitle&#39;</span>, </a>
<a class="sourceLine" id="cb52-5" title="5">    <span class="dt">caption =</span> <span class="st">&#39;caption&#39;</span>, </a>
<a class="sourceLine" id="cb52-6" title="6">    <span class="dt">tag_levels =</span> <span class="st">&#39;a&#39;</span>, <span class="co"># &#39;a&#39;, &#39;A&#39;, &#39;1&#39;, &#39;i&#39;, &#39;I&#39;</span></a>
<a class="sourceLine" id="cb52-7" title="7">    <span class="dt">tag_prefix =</span> <span class="st">&#39;Figure &#39;</span>,</a>
<a class="sourceLine" id="cb52-8" title="8">    <span class="dt">tag_suffix =</span> <span class="st">&#39;.&#39;</span>,</a>
<a class="sourceLine" id="cb52-9" title="9">    <span class="dt">tag_sep =</span> <span class="ot">NULL</span>, <span class="co"># ナゾ</span></a>
<a class="sourceLine" id="cb52-10" title="10">    <span class="dt">theme =</span> <span class="kw">theme_classic</span>() <span class="co"># 全体に適応するテーマ</span></a>
<a class="sourceLine" id="cb52-11" title="11">  )</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-60-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>凡例を含む図も綺麗に並べてくれる</h2>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1">p5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(minicars, <span class="kw">aes</span>(wt, mpg, <span class="dt">color =</span> vs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&#39;p5&#39;</span>)</a>
<a class="sourceLine" id="cb53-3" title="3">p1 <span class="op">/</span><span class="st"> </span>p5</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-61-1.svg" width="768" /></p>
</section><section class="slide level2">
<h2>多くパッケージで標準的な並べ方</h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb54-2" title="2"><span class="kw">grid.arrange</span>(p1, p5, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-62-1.svg" width="768" /></p>
</section></section>
<section><section class="title-slide slide level1"><h1>まとめ</h1></section><section id="up-to-you" class="slide level2">
<h2>使い分けが肝心</h2>
<p><br/></p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">データ</th>
<th style="text-align: left;">図の種類</th>
<th style="text-align: left;">並べかた</th>
<th style="text-align: left;">軸の表示</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>facet_grid</td>
<td style="text-align: left;">同じ</td>
<td style="text-align: left;">同じ</td>
<td style="text-align: left;">表形式</td>
<td style="text-align: left;">端のみ</td>
</tr>
<tr class="even">
<td>facet_wrap</td>
<td style="text-align: left;">同じ</td>
<td style="text-align: left;">同じ</td>
<td style="text-align: left;">改行</td>
<td style="text-align: left;">scales引数次第</td>
</tr>
<tr class="odd">
<td>patchwork</td>
<td style="text-align: left;">自由</td>
<td style="text-align: left;">自由</td>
<td style="text-align: left;">自由</td>
<td style="text-align: left;">全て</td>
</tr>
</tbody>
</table>
<p><br/></p>
<ul>
<li><a href="#/vary-plot-types">工夫次第ではfacetも異なるデータや図を扱える</a></li>
<li><a href="#/side-by-side">patchworkは自由度が高いが、<br />
並べる図を一つずつ作る必要がある</a></li>
<li><a href="#/vary-x-fix-y"><code>tidyr::gather</code> と <code>facet</code> の組み合わせが便利</a></li>
<li><a href="#/nice-facet-grid">ggplot2は簡単に纏まりある図を作れるけれど，<br />
本当に綺麗な図か，よく考えよう</a></li>
</ul>
</section><section id="enjoy" class="slide level2">
<h2>Enjoy !</h2>
<p><img src="tokyor073-multi-ggplot2_files/figure-revealjs/unnamed-chunk-63-1.svg" width="768" /></p>
</section></section>
    </div>
  </div>

  <script src="tokyor073-multi-ggplot2_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="tokyor073-multi-ggplot2_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: true,
        // Transition style
        transition: 'default', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom



        // Optional reveal.js plugins
        dependencies: [
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
